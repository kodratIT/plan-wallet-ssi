@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Component Diagram - Credential Management Architecture (Sprint 2)
caption Complete Credential Management System with Manifest & OCA Support

LAYOUT_WITH_LEGEND()

Container_Boundary(ui, "UI Layer") {
    Component(credScreen, "Credentials Screen", "React Native", "Main credential list/grid view")
    Component(credCard, "Credential Card", "React Component", "Reusable card dengan OCA styling")
    Component(credDetail, "Credential Detail", "React Component", "Detailed credential view")
    Component(searchUI, "Search & Filter UI", "React Component", "Search bar dan filter controls")
    Component(exportUI, "Export/Share UI", "React Component", "Export options dan share sheet")
}

Container_Boundary(state, "State Management") {
    Component(credStore, "Credential Store", "Redux Slice", "Credential state management")
    Component(searchStore, "Search Store", "Redux Slice", "Search and filter state")
    Component(categoryStore, "Category Store", "Redux Slice", "Category and organization state")
}

Container_Boundary(services, "Business Logic Layer") {
    Component(manifestService, "Credential Manifest Service", "TypeScript", "Parse dan handle credential manifests")
    Component(ocaService, "OCA Renderer Service", "TypeScript", "Fetch dan apply OCA overlays")
    Component(registryService, "Credential Registry", "TypeScript", "Manage credential types dan schemas")
    Component(searchService, "Search Service", "Fuse.js", "Full-text search dan filtering")
    Component(categoryService, "Category Service", "TypeScript", "Auto-categorization dan organization")
    Component(exportService, "Export Service", "TypeScript", "Export ke JSON/QR/PDF")
    Component(shareService, "Share Service", "TypeScript", "Share via DIDComm dan native")
    Component(activityService, "Activity Logger", "TypeScript", "Track credential activities")
}

Container_Boundary(data, "Data Layer") {
    ComponentDb(credDB, "Credential Database", "TypeORM/SQLite", "Persistent credential storage")
    ComponentDb(categoryDB, "Category Database", "TypeORM/SQLite", "Category dan favorites storage")
    ComponentDb(activityDB, "Activity Database", "TypeORM/SQLite", "Activity log storage")
    ComponentDb(cacheDB, "Cache Database", "AsyncStorage", "OCA bundles dan manifests cache")
}

System_Ext(ocaRegistry, "OCA Registry", "External OCA bundle provider")
System_Ext(manifestRegistry, "Manifest Registry", "External manifest provider")
System_Ext(schemaRegistry, "Schema Registry", "External schema provider")

' UI to State
Rel(credScreen, credStore, "Reads/updates", "Redux")
Rel(credCard, credStore, "Reads", "Redux")
Rel(searchUI, searchStore, "Updates search/filter", "Redux")
Rel(credDetail, credStore, "Reads", "Redux")

' State to Services
Rel(credStore, manifestService, "Fetch manifests")
Rel(credStore, ocaService, "Apply OCA styling")
Rel(credStore, registryService, "Register types")
Rel(searchStore, searchService, "Perform search")
Rel(categoryStore, categoryService, "Manage categories")
Rel(credStore, activityService, "Log activities")

' Services to External
Rel(manifestService, manifestRegistry, "Fetch manifests", "HTTPS")
Rel(ocaService, ocaRegistry, "Fetch OCA bundles", "HTTPS")
Rel(registryService, schemaRegistry, "Resolve schemas", "HTTPS")

' Services to Data
Rel(manifestService, credDB, "Store credentials")
Rel(categoryService, categoryDB, "Store categories")
Rel(activityService, activityDB, "Store activities")
Rel(ocaService, cacheDB, "Cache OCA bundles")
Rel(manifestService, cacheDB, "Cache manifests")

' Export flows
Rel(exportUI, exportService, "Export credential")
Rel(exportService, shareService, "Share exported file")

SHOW_LEGEND()

note right of manifestService
**Credential Manifest (US-2.1):**
• Parse credential manifests
• Handle output descriptors
• Process presentation definitions
• Generate credential applications
• Handle credential responses
end note

note right of ocaService
**OCA Rendering (US-2.2):**
• Fetch OCA bundles
• Apply branding overlay
• Apply label overlay
• Apply format overlay
• Generate styled cards
end note

note right of searchService
**Search & Filter (US-2.6):**
• Full-text fuzzy search
• Filter by type
• Filter by issuer
• Filter by status
• Filter by date
• Search history
end note

note right of exportService
**Export/Share (US-2.8):**
• Export to JSON
• Generate QR code
• Generate PDF
• Share via DIDComm
• Native share sheet
end note

@enduml
